{"pageProps":{"meta":{"title":"B站反查用户弹幕小记","date":"2018-08-15 08:00","tags":["web","经验"],"categories":"工具","description":"B站反查用户弹幕小记","keywords":"bilibili，弹幕，查询，逆向"},"content":"\r\n工具：Chrome浏览器\r\n\r\n反查用户分为视频里现存的弹幕反查和历史弹幕反查。其中反查历史弹幕需要用Chrome的调试工具，需要懂一点前端，比较简单，仍然是非技术向的一个小记。\r\n\r\n## 从视频里现存的弹幕反查用户\r\n\r\n能有工具用就用。以下两个工具都能实现从视频里现存的弹幕反查用户。\r\n\r\n- [Bilibili弹幕发送查询](https://www.b612.me/danmu/)\r\n- Chrome扩展[Bilibili Helper](https://chrome.google.com/webstore/detail/哔哩哔哩助手：bilibilicom-综合辅助扩展/kpbnombpnpcffllnianjibmpadjolanh?hl=en-US)\r\n\r\n## 从历史弹幕里反查\r\n\r\n了解原理需要知道前端的基础。原理在[这篇文章](https://typcn.com/legacy/blog/posts/bilibili-comment-sender-digger.html)里说得很清楚了，一定要看。（目前文章已失效，请继续往下看）\r\n\r\n问题是在于历史弹幕文件的获取。2018年历史弹幕的API有变动，需要用户已经登录了才能获取（因为页面的请求方式是是Request），因此之前网上的工具箱都没法用了。这里说一下使用Chrome的开发者工具获取历史弹幕并反查用户的方式。\r\n\r\n首先，Chrome需要登录过bilibili，这样才能有cookie。\r\n\r\n然后打开一个视频，这里用[av29242495](https://www.bilibili.com/video/av29242495)为例。\r\n\r\n开启Chrome的开发者工具，并选择network选项卡，刷新一下，大概是这样。\r\n\r\n![Chrome.png](https://ww1.sinaimg.cn/large/6530f589ly1g8jz1fap2vj21yk11gnpd.jpg)\r\n\r\n在上图的bilibili界面中选\"查看历史弹幕\"，选则一个日期（我选的8月14日）。然后在右侧的Filter中填入history，结果是这样\r\n\r\n![HistoryDanma.png](https://ww1.sinaimg.cn/large/6530f589ly1g8jz3gihc4j21y61187wh.jpg)\r\n\r\n其中以history开头的文件就是我们所需要的历史弹幕文件，双击就可以在新标签页中打开。这个例子中的历史弹幕文件地址长这样：\r\n\r\n```\r\nhttps://api.bilibili.com/x/v2/dm/history?type=1&oid=50775916&date=2018-08-13\r\n```\r\n\r\n可以见这个历史弹幕的api就长这样，oid是视频的编号（不是av号），后面加个date。type=1目前我没弄清楚是什么。\r\n\r\n弹幕文件里的弹幕都是这个样子的\r\n\r\n```xml\r\n<d p=\"弹幕出现时间,模式,字体大小,颜色,发送时间戳,弹幕池,用户Hash,数据库ID\">123123</d>\r\n<!--比如-->\r\n<d p=\"10.15700,1,25,16777215,1534175832,0,39d120,3687662110113792\">卧槽番外</d>\r\n<d p=\"19.93100,1,25,16777215,1534175761,0,6acc8733,3687624958541824\">台词太强了，节奏太好了</d>\r\n<d p=\"24.98000,1,25,16777215,1534175677,0,f11c8b72,3687580849668100\">来啦 给大大比心</d>\r\n```\r\n\r\n其中要用的是用户Hash。用户Hash只是简单的把数字ID用[ITU I.363.5](http://www.itu.int/rec/T-REC-I.363.5-199608-I/en)算法进行了Hash。不过这里不用手动写算法了，因为下面的接口还能用。\r\n\r\n```\r\nhttps://biliquery.typcn.com/api/user/hash/[用户Hash]\r\n```\r\n\r\n比如我从文件里任意选了两个用户Hash，替换掉上面的[用户Hash]，分别返回了如下结果\r\n\r\n```json\r\n{\"error\":0,\"data\":[{\"id\":17882889}]} // 比较老的用户\r\n{\"error\":0,\"data\":[{\"id\":390105526},{\"id\":21670130}]} // 一般新用户\r\n```\r\n\r\n用户ID(uid)为后者。用B站的个人主页网址格式就能找到了弹幕发送者的主页了。格式如下\r\n\r\n```\r\nhttps://space.bilibili.com/uid/#/\r\n```","excerpt":" 工具：Chrome浏览器  反查用户分为视频里现存的弹幕反查和历史弹幕反查。其中反查历史弹幕需要用Chrome的调试工具，需要懂一点前端，比较简单，仍然是非技术向的一个小记。  ## 从视频里现存的弹幕反查用户  能有工具用就用。以下两个工具都能实现从视频里现存的弹幕反查用户。  - ","prevPost":{"title":"近期资源整理2018-08-17","link":"/posts/近期资源整理2018-08-17"},"nextPost":{"title":"使用pandoc转换md为PDF并添加中文支持","link":"/posts/使用pandoc转换md为PDF并添加中文支持"},"headings":[]},"__N_SSG":true}